const bundleId = Date.now();

let dataToSendOne = {
  subscriptions: [
    {
      "charge_interval_frequency": "30",
      "next_charge_scheduled_at": "2022-12-09",
      "order_interval_frequency": "30",
      "order_interval_unit": "day",
      "quantity": 1,
      "shopify_variant_id": 43174903218433,
      "properties[_bundle]": "Build A Box",
      "properties[_bundle_id]": bundleId,
      "properties[_bundle_item_index]": "1",
      "properties[_bundle_price]": "1900000",
      "properties[_bundle_item_titles]": "USDA Prime New York Strip 16 oz, USDA Prime Ribeye 22 oz, USDA Prime Filet 8 oz, USDA Prime Tomahawk, ",
      "properties[_bundle_img]": "https://cdn.shopify.com/s/files/1/0463/6586/8198/files/GS-Logo-Gold.png?v=1599678055"
    },
    {
      "charge_interval_frequency": "30",
      "next_charge_scheduled_at": "2022-12-09",
      "order_interval_frequency": "30",
      "order_interval_unit": "day",
      "quantity": 1,
      "shopify_variant_id": 43174904135937,
      "properties[_bundle": "Build A Box",
      "properties[_bundle_id": bundleId,
      "properties[_bundle_item_index": "2",
      "properties[_bundle_price": "1900000",
      "properties[_bundle_item_titles": "USDA Prime New York Strip 16 oz, USDA Prime Ribeye 22 oz, USDA Prime Filet 8 oz, USDA Prime Tomahawk, ",
      "properties[_bundle_img": "https://cdn.shopify.com/s/files/1/0463/6586/8198/files/GS-Logo-Gold.png?v=1599678055"
    },
    {
      "charge_interval_frequency": "30",
      "next_charge_scheduled_at": "2022-12-09",
      "order_interval_frequency": "30",
      "order_interval_unit": "day",
      "quantity": 1,
      "shopify_variant_id": 43174901907713,
      "properties[_bundle": "Build A Box",
      "properties[_bundle_id": bundleId,
      "properties[_bundle_item_index": "3",
      "properties[_bundle_price": "1900000",
      "properties[_bundle_item_titles": "USDA Prime New York Strip 16 oz, USDA Prime Ribeye 22 oz, USDA Prime Filet 8 oz, USDA Prime Tomahawk, ",
      "properties[_bundle_img": "https://cdn.shopify.com/s/files/1/0463/6586/8198/files/GS-Logo-Gold.png?v=1599678055"
    },
    {
      "charge_interval_frequency": "30",
      "next_charge_scheduled_at": "2022-12-09",
      "order_interval_frequency": "30",
      "order_interval_unit": "day",
      "quantity": 1,
      "shopify_variant_id": 43174904627457,
      "properties[_bundle]": "Build A Box",
      "properties[_bundle_id]": bundleId,
      "properties[_bundle_item_index]": "4",
      "properties[_bundle_price]": "1900000",
      "properties[_bundle_item_titles]": "USDA Prime New York Strip 16 oz, USDA Prime Ribeye 22 oz, USDA Prime Filet 8 oz, USDA Prime Tomahawk, ",
      "properties[_bundle_img]": "https://cdn.shopify.com/s/files/1/0463/6586/8198/files/GS-Logo-Gold.png?v=1599678055"
    },
  ]
}

let dataToSendTwo = {
  "subscriptions": [
    {
      "charge_interval_frequency": "30",
      "next_charge_scheduled_at": "2022-12-09",
      "order_interval_frequency": "30",
      "order_interval_unit": "day",
      "quantity": 1,
      "shopify_variant_id": 43174903218433,
      "properties[_bundle]": "Build A Box",
      "properties[_bundle_id]": "1661121696509",
      "properties[_bundle_item_index]": "1",
      "properties[_bundle_price]": "1801762",
      "properties[_bundle_item_titles]": "USDA Prime New York Strip 16 oz, USDA Prime Tomahawk, USDA Prime Ribeye 22 oz, USDA Prime Filet 8 oz, Sergio's 8 oz Seasoning, ",
      "properties[_bundle_img]": "https://cdn.shopify.com/s/files/1/0463/6586/8198/files/GS-Logo-Gold.png?v=1599678055"
    },
    {
      "charge_interval_frequency": "30",
      "next_charge_scheduled_at": "2022-12-09",
      "order_interval_frequency": "30",
      "order_interval_unit": "day",
      "quantity": 1,
      "shopify_variant_id": 43174904135937,
      "properties[_bundle]": "Build A Box",
      "properties[_bundle_id]": "1661121696509",
      "properties[_bundle_item_index]": "2",
      "properties[_bundle_price]": "1801762",
      "properties[_bundle_item_titles]": "USDA Prime New York Strip 16 oz, USDA Prime Tomahawk, USDA Prime Ribeye 22 oz, USDA Prime Filet 8 oz, Sergio's 8 oz Seasoning, ",
      "properties[_bundle_img]": "https://cdn.shopify.com/s/files/1/0463/6586/8198/files/GS-Logo-Gold.png?v=1599678055"
    },
    {
      "charge_interval_frequency": "30",
      "next_charge_scheduled_at": "2022-12-09",
      "order_interval_frequency": "30",
      "order_interval_unit": "day",
      "quantity": 1,
      "shopify_variant_id": 43174901907713,
      "properties[_bundle]": "Build A Box",
      "properties[_bundle_id]": "1661121696509",
      "properties[_bundle_item_index]": "3",
      "properties[_bundle_price]": "1801762",
      "properties[_bundle_item_titles]": "USDA Prime New York Strip 16 oz, USDA Prime Tomahawk, USDA Prime Ribeye 22 oz, USDA Prime Filet 8 oz, Sergio's 8 oz Seasoning, ",
      "properties[_bundle_img]": "https://cdn.shopify.com/s/files/1/0463/6586/8198/files/GS-Logo-Gold.png?v=1599678055"
    },
    {
      "charge_interval_frequency": "30",
      "next_charge_scheduled_at": "2022-12-09",
      "order_interval_frequency": "30",
      "order_interval_unit": "day",
      "quantity": 1,
      "shopify_variant_id": 43174904627457,
      "properties[_bundle]": "Build A Box",
      "properties[_bundle_id]": "1661121696509",
      "properties[_bundle_item_index]": "4",
      "properties[_bundle_price]": "1801762",
      "properties[_bundle_item_titles]": "USDA Prime New York Strip 16 oz, USDA Prime Tomahawk, USDA Prime Ribeye 22 oz, USDA Prime Filet 8 oz, Sergio's 8 oz Seasoning, ",
      "properties[_bundle_img]": "https://cdn.shopify.com/s/files/1/0463/6586/8198/files/GS-Logo-Gold.png?v=1599678055"
    },
    {
      "charge_interval_frequency": "30",
      "next_charge_scheduled_at": "2022-12-09",
      "order_interval_frequency": "30",
      "order_interval_unit": "day",
      "quantity": 1,
      "shopify_variant_id": 42552716001537,
      "properties[_bundle]": "Build A Box",
      "properties[_bundle_id]": "1661121696509",
      "properties[_bundle_item_index]": "5",
      "properties[_bundle_price]": "1801762",
      "properties[_bundle_item_titles]": "USDA Prime New York Strip 16 oz, USDA Prime Tomahawk, USDA Prime Ribeye 22 oz, USDA Prime Filet 8 oz, Sergio's 8 oz Seasoning, ",
      "properties[_bundle_img]": "https://cdn.shopify.com/s/files/1/0463/6586/8198/files/GS-Logo-Gold.png?v=1599678055"
    }
  ]
}

const addressId = 101360540;

// window.BundleCampaign.Bundle.createEndPoint(addressId, dataToSendTwo).then(console.log);

window.BundleCampaign.Bundle.createEndPoint(addressId, dataToSendOne).then(updateSubscriptionWithProperties);

async function ajaxPost(url, data) {
  return new Promise((resolve, reject) => {
    $.ajax({
      url: url,
      type: "post",
      dataType: "json",
      data: data,
    })
      .done(function (response) {
        // Successful request made
        resolve(response);
      })
      .fail(function (response) {
        // Request failed
        reject(response);
      });
  });
}

async function updateSubscriptionWithProperties({ subscriptions }) {
  for (let i = 0; i < subscriptions.length; i++) {
    const subscription = subscriptions[i];
    const data = dataToSendOne.subscriptions.find(sub => sub.shopify_variant_id == subscription.shopify_variant_id);
    delete data["shopify_variant_id"];
    data.id = subscription.id;
    const url = ReCharge.Endpoints.update_subscription_url(subscription.id);
    const result = await ajaxPost(url, data);
    console.log(result);
  }
}




async function createSubscriptionRecharge(data) {
  return new Promise((resolve, reject) => {
    $.ajax({
      url: `/tools/recurring/portal/67dcfe6dff46984bd3f0c1a8ff4968/subscriptions/new?token=${window.customerToken}`,
      type: "post",
      dataType: "json",
      data: data,
    })
      .done(function (response) {
        // Successful request made
        resolve(response);
      })
      .fail(function (response) {
        // Request failed
        reject(response);
      });
  });
}

async function addSubWithProperties(subscriptions) {
  for(let i = 0; i < subscriptions.length; i+=1) {
    const subscription = subscriptions[0];
    try {
      const result = await createSubscriptionRecharge(subscription);
      console.log(result);
    } catch (error) {
      console.log(error);
    }
  }
}
